{% extends "base.html" %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/calculator.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <header class="mb-4 text-center">
        <h1 id="main-page-title">{{ page_title }}</h1>
        <p class="lead" id="calculator-page-subtitle">
            {# This subtitle will be updated by calculator.js #}
        </p>
    </header>

    {# Calculator section navigation bar (HTML structure remains the same) #}
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-3">
      <div class="container">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#calculatorSubNav" aria-controls="calculatorSubNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="calculatorSubNav">
          <ul class="navbar-nav w-90 justify-content-evenly">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle fw-bold text-center" href="#" id="dropdownAISL" role="button" data-bs-toggle="dropdown" aria-expanded="false">AI SL</a>
              <ul class="dropdown-menu scrollable-dropdown" aria-labelledby="dropdownAISL">
                <li class="dropdown-header">1 Number and Algebra</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="scientific_notation.html">1.1 Scientific notation and rounding</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="arithmetic_sequences.html">1.2 Arithmetic sequences and series</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="geometric_sequences.html">1.3 Geometric sequences and series</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="compound_interests.html">1.4 Compound interests</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="laws_of_exponents.html">1.5 Laws of exponents with integer exponents, logarithms</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="amortization.html">1.7 Amortization and annuities</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="systems_linear.html">1.8 Systems of linear equations and polynomial equations</a></li>
                <li class="dropdown-header">2 Functions</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="graph_function.html">2.3 Graph a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="key_features_graph.html">2.4 Key features of graphs</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="roots_quadratic.html">2.5 Find roots of quadratic functions</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="solve_simultaneous.html">2.6 Solve simultaneous equations</a></li>
                <li class="dropdown-header">3 Geometry and Trigonometry</li>
                <li class="dropdown-header">4 Statistics and Probability</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="statistical_measures.html">4.3 Statistical measures on one variable data</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="line_best_fit.html">4.4 Line of best fit</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="binomial_distribution.html">4.8 Binomial distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="normal_distribution.html">4.9 Normal distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="spearman_rank.html">4.10 Spearman’s Rank coefficient</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="statistical_tests.html">4.11 Statistical tests</a></li>
                <li class="dropdown-header">5 Calculus</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="derivative_function.html">5.3 Derivative of a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="tangents_normals.html">5.4 Tangents and normals to a curve</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="definite_integrals.html">5.5 Definite integrals</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="local_min_max.html">5.6 Local minimum and local maximum of a function</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle fw-bold text-center" href="#" id="dropdownAIHL" role="button" data-bs-toggle="dropdown" aria-expanded="false">AI HL</a>
              <ul class="dropdown-menu scrollable-dropdown" aria-labelledby="dropdownAIHL">
                <li class="dropdown-header">1 Number and Algebra</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="scientific_notation.html">1.1 Scientific notation and rounding</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="arithmetic_sequences.html">1.2 Arithmetic sequences and series</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="geometric_sequences.html">1.3 Geometric sequences and series</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="compound_interests.html">1.4 Compound interests</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="laws_of_exponents.html">1.5 Laws of exponents with integer exponents, logarithms</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="amortization.html">1.7 Amortization and annuities</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="laws_of_logarithms.html">1.9 Laws of logarithms</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="complex_numbers.html">1.12 Complex numbers</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="cartesian_polar.html">1.13 Complex numbers: cartesian and polar form</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="matrices.html">1.14 Matrices</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="eigenvalues.html">1.15 Eigenvalues and eigenvectors</a></li>
                <li class="dropdown-header">2 Functions</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="graph_function.html">2.3 Graph a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="key_features_graph.html">2.4 Key features of graphs</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="roots_quadratic.html">2.5 Find roots of quadratic functions</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="solve_simultaneous.html">2.6 Solve simultaneous equations</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="composite_functions.html">2.7 Composite functions</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="transformations_graphs.html">2.8 Transformations of graphs</a></li>
                <li class="dropdown-header">3 Geometry and Trigonometry</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="degrees_radians.html">3.7 Degrees and radians</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="unit_circle.html">3.8 Unit circle</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="geometric_transformations.html">3.9 Geometric transformations using matrices</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="scalar_vector.html">3.10 Scalar product and vector product</a></li>
                <li class="dropdown-header">4 Statistics and Probability</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="statistical_measures.html">4.3 Statistical measures on one variable data</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="line_best_fit.html">4.4 Line of best fit</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="binomial_distribution.html">4.8 Binomial distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="normal_distribution.html">4.9 Normal distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="reliability.html">4.12 Reliability and validity</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="poisson_distribution.html">4.15 Poisson distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="transition_matrices.html">4.17 Transition matrices</a></li>
                <li class="dropdown-header">5 Calculus</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="derivative_function.html">5.3 Derivative of a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="tangents_normals.html">5.4 Tangents and normals to a curve</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="definite_integrals.html">5.5 Definite integrals</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="euler_method.html">5.16 Euler method for differential equations</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle fw-bold text-center" href="#" id="dropdownAASL" role="button" data-bs-toggle="dropdown" aria-expanded="false">AA SL</a>
              <ul class="dropdown-menu scrollable-dropdown" aria-labelledby="dropdownAASL">
                <li class="dropdown-header">1 Number and Algebra</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="scientific_notation.html">1.1 Scientific notation and rounding</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="arithmetic_sequences.html">1.2 Arithmetic sequences and series</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="geometric_sequences.html">1.3 Geometric sequences and series</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="compound_interests.html">1.4 Compound interests</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="laws_of_exponents.html">1.5 Laws of exponents with integer exponents, logarithms</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="amortization.html">1.7 Amortization and annuities</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="systems_linear.html">1.8 Systems of linear equations and polynomial equations</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="laws_of_logarithms.html">1.9 Laws of logarithms</a></li>
                <li class="dropdown-header">2 Functions</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="graph_function.html">2.3 Graph a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="key_features_graph.html">2.4 Key features of graphs</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="roots_quadratic.html">2.5 Find roots of quadratic functions</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="solve_simultaneous.html">2.6 Solve simultaneous equations</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="composite_functions.html">2.7 Composite functions</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="transformations_graphs.html">2.8 Transformations of graphs</a></li>
                <li class="dropdown-header">3 Geometry and Trigonometry</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="degrees_radians.html">3.7 Degrees and radians</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="unit_circle.html">3.8 Unit circle</a></li>
                <li class="dropdown-header">4 Statistics and Probability</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="statistical_measures.html">4.3 Statistical measures on one variable data</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="line_best_fit.html">4.4 Line of best fit</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="binomial_distribution.html">4.8 Binomial distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="normal_distribution.html">4.9 Normal distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="spearman_rank.html">4.10 Spearman’s Rank coefficient</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="statistical_tests.html">4.11 Statistical tests</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="test_retest.html">4.12 Test-retest</a></li>
                <li class="dropdown-header">5 Calculus</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="derivative_function.html">5.3 Derivative of a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="tangents_normals.html">5.4 Tangents and normals to a curve</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="definite_integrals.html">5.5 Definite integrals</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="local_min_max.html">5.6 Local minimum and local maximum of a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="second_derivative.html">5.7 Second derivative</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle fw-bold text-center" href="#" id="dropdownAAHL" role="button" data-bs-toggle="dropdown" aria-expanded="false">AA HL</a>
              <ul class="dropdown-menu scrollable-dropdown" aria-labelledby="dropdownAAHL">
                <li class="dropdown-header">1 Number and Algebra</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="scientific_notation.html">1.1 Scientific notation and rounding</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="arithmetic_sequences.html">1.2 Arithmetic sequences and series</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="geometric_sequences.html">1.3 Geometric sequences and series</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="compound_interests.html">1.4 Compound interests</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="laws_of_exponents.html">1.5 Laws of exponents with integer exponents, logarithms</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="amortization.html">1.7 Amortization and annuities</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="systems_linear.html">1.8 Systems of linear equations and polynomial equations</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="laws_of_logarithms.html">1.9 Laws of logarithms</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="complex_numbers.html">1.12 Complex numbers</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="cartesian_polar.html">1.13 Complex numbers: cartesian and polar form</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="matrices.html">1.14 Matrices</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="eigenvalues.html">1.15 Eigenvalues and eigenvectors</a></li>
                <li class="dropdown-header">2 Functions</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="graph_function.html">2.3 Graph a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="key_features_graph.html">2.4 Key features of graphs</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="roots_quadratic.html">2.5 Find roots of quadratic functions</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="solve_simultaneous.html">2.6 Solve simultaneous equations</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="composite_functions.html">2.7 Composite functions</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="transformations_graphs.html">2.8 Transformations of graphs</a></li>
                <li class="dropdown-header">3 Geometry and Trigonometry</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="degrees_radians.html">3.7 Degrees and radians</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="unit_circle.html">3.8 Unit circle</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="geometric_transformations.html">3.9 Geometric transformations using matrices</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="scalar_vector.html">3.10 Scalar product and vector product</a></li>
                <li class="dropdown-header">4 Statistics and Probability</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="statistical_measures.html">4.3 Statistical measures on one variable data</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="line_best_fit.html">4.4 Line of best fit</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="binomial_distribution.html">4.8 Binomial distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="normal_distribution.html">4.9 Normal distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="standardization.html">4.10 Standardization of normal variables</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="t_distribution.html">4.11 The t-distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="poisson_distribution.html">4.12 Poisson distribution</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="transition_matrices.html">4.14 Transition matrices</a></li>
                <li class="dropdown-header">5 Calculus</li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="derivative_function.html">5.3 Derivative of a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="tangents_normals.html">5.4 Tangents and normals to a curve</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="definite_integrals.html">5.5 Definite integrals</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="local_min_max.html">5.6 Local minimum and local maximum of a function</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="second_derivative.html">5.10 Second derivative</a></li>
                <li><a class="dropdown-item calculator-nav-link" href="#" data-filename="euler_method.html">5.16 Euler method for differential equations</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    {# Container for data passed from Django to JavaScript #}
    <div id="calculator-data-container" 
         data-initial-filename="{{ initial_page_filename_for_js|escapejs }}" 
         data-current-page-title-for-subtitle="{{ current_page_title_for_subtitle|escapejs }}"
         data-page-title="{{ page_title|escapejs }}"
         data-static-url="{% get_static_prefix %}"
         data-calculator-image-base-path="img/calculator_pics/" {# NOUVEAU CHEMIN: relatif à STATIC_URL #}
         data-api-base-url="{% url 'calculator:api_get_page_content' filename="PLACEHOLDER_FILENAME" %}"
         data-interactive-index-base-url="{% url 'calculator:interactive_index' %}"
         data-interactive-index-with-file-base-url="{% url 'calculator:interactive_index_with_file' filename="PLACEHOLDER_FILENAME" %}"
         style="display: none;">
    </div>

    {# Template to hold initial HTML content if provided by the server. JS will read from here. #}
    <template id="initial-html-content-template">
        {% if initial_html_content_for_js %}{{ initial_html_content_for_js|safe }}{% endif %}
    </template>

    <div id="calculator-content-display" class="calculator-content-wrapper mt-3">
        {# JavaScript will populate this or display the placeholder #}
        <p id="initial-placeholder" class="text-center text-muted p-5">Select a topic from the menu above to display its content.</p>
    </div>

    <div id="loading-indicator" class="text-center my-3" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{# MathJax Configuration BEFORE loading MathJax script #}
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      tags: 'ams'
    },
    svg: {
      fontCache: 'global'
    },
    options: {},
    startup: {
      ready: () => {
        console.log('MathJax global configuration is ready.');
        MathJax.startup.defaultReady();
        // Dispatch a custom event to signal that MathJax is ready for calculator.js
        document.dispatchEvent(new CustomEvent('mathJaxReadyForCalculator'));
      }
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

{# Load custom JavaScript file #}
<script src="{% static 'js/calculator.js' %}" defer></script>
{% endblock %}
